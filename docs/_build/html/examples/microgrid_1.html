<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Exemple de gestion d’énergie et de dimensionnement d’un micro-réseau &mdash; pyomo-lmes 1.1+22.gbddc002.dirty documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Modeling battery with maximal charging power limit" href="battery_piecewise_charging_limits.html" />
    <link rel="prev" title="Working with pyomo-lmes library components" href="../examples_lms2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> pyomo-lmes
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#installing-python-distribution-anaconda">Installing Python distribution (Anaconda)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#install-pyomo-lmes-from-source">Install pyomo-lmes from source</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Tutorial and Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../examples_pyomo.html">Working with Pyomo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples_pyomo.html#simple-example-using-pyomo-language">1) Simple example using pyomo language</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples_pyomo.html#working-with-pyomo-abstract-model">2) working with pyomo  abstract model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples_lms2.html">Working with pyomo-lmes library components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples_lms2.html#example-of-a-block">1) Example of a block</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples_lms2.html#example-of-model-by-aggregation-of-library-s-blocks">2) Example of model by aggregation of library’s blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples_lms2.html#example-of-creating-blocks-indexed-by-a-set">3) Example of creating blocks indexed by a set</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Exemple de gestion d’énergie et de dimensionnement d’un micro-réseau</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Instanciation-du-problème-d’optimisation-et-de-l’horizon-temporel">Instanciation du problème d’optimisation et de l’horizon temporel</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Exemple-de-contrainte-sur-le-bilan-de-puissance">Exemple de contrainte sur le bilan de puissance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Exemple-d’une-expression">Exemple d’une expression</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Exemple-d’intégration-temporelle">Exemple d’intégration temporelle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Exemple-de-définition-de-l’objectif">Exemple de définition de l’objectif</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Discrétisation-temporelle">Discrétisation temporelle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Chargement-des-données">Chargement des données</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Index-entier">Index entier</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Index-en-chaîne-de-caractères">Index en chaîne de caractères</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="battery_piecewise_charging_limits.html">Modeling battery with maximal charging power limit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="battery_piecewise_charging_limits.html#Optimization-problem">Optimization problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="battery_piecewise_charging_limits.html#Discretization-every-10min">Discretization every 10min</a><ul>
<li class="toctree-l4"><a class="reference internal" href="battery_piecewise_charging_limits.html#Definition-of-the-source.">Definition of the source.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="battery_piecewise_charging_limits.html#Post-processing">Post-processing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../builddoc.html">How to build the documentation ?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lms2.html">Library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../lms2.base.html">Base</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.base.block.html">block</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.base.block.effort_source.html">effort_source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.base.block.fix_profile.html">fix_profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.base.block.flow_load.html">flow_load</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.base.block.flow_source.html">flow_source</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lms2.core.html">Core</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.core.models.html">models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.core.models.AbsLModel.html">AbsLModel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.core.models.LModel.html">LModel</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lms2.economic.html">Economic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.economic.cost.html">cost</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.economic.cost.absolute_cost.html">absolute_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.economic.cost.bilinear_cost.html">bilinear_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.economic.cost.bilinear_dynamic_cost.html">bilinear_dynamic_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.economic.cost.capital_recovery_factor.html">capital_recovery_factor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.economic.cost.lifecycle_cost.html">lifecycle_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.economic.cost.linear_cost.html">linear_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.economic.cost.linear_dyn_cost.html">linear_dyn_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.economic.cost.maintenance_cost.html">maintenance_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.economic.cost.recycling_cost.html">recycling_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.economic.cost.replacement_cost.html">replacement_cost</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lms2.electric.html">Electric</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.electric.batteries.html">batteries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.batteries.battery_V0.html">battery_V0</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.batteries.battery_v1.html">battery_v1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.batteries.battery_v2.html">battery_v2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.batteries.battery_v3.html">battery_v3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.electric.converters.html">converters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.converters.converter_simple.html">converter_simple</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.electric.sources.html">sources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.sources.curtailable_load.html">curtailable_load</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.sources.curtailable_load_2.html">curtailable_load_2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.sources.debug_source.html">debug_source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.sources.fixed_power_load.html">fixed_power_load</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.sources.fixed_power_source.html">fixed_power_source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.sources.power_load.html">power_load</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.sources.power_source.html">power_source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.sources.pv_panel.html">pv_panel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.sources.scalable_power_load.html">scalable_power_load</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.sources.scalable_power_source.html">scalable_power_source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.electric.sources.square.html">square</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lms2.environment.html">Environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.environment.ghg.html">ghg</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.environment.ghg.def_linear_ghg_cost.html">def_linear_ghg_cost</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.environment.environment.html">environment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.environment.environment.environment.html">environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.environment.environment.solar_inputs.html">solar_inputs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lms2.building.html">Building</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.building.dwellings.html">dwellings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.building.dwellings.dwelling_v1.html">dwelling_v1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.building.dwellings.dwelling_v2.html">dwelling_v2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.building.graph.html">graph</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.building.graph.build_2zone_graph.html">build_2zone_graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.building.graph.build_dummy_1zone_graph.html">build_dummy_1zone_graph</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.building.structure.html">structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.building.structure.thermal_structure_block.html">thermal_structure_block</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.building.systems.html">systems</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.building.systems.heat_pump.html">heat_pump</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.building.systems.hot_water_tank.html">hot_water_tank</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../lms2.building.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lms2.fluids.html">Fluids</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.fluids.modelCO2.html">modelCO2</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.fluids.modelCO2.ModelCO2.html">ModelCO2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.fluids.modelCO2.ModelCO2_bis.html">ModelCO2_bis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lms2.logical.html">Logical</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.logical.sequencial.html">sequencial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.logical.sequencial.add_phase.html">add_phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.logical.sequencial.Hysteresis.html">Hysteresis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lms2.mechanic.html">Mechanic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.mechanic.gears.html">gears</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lms2.social.html">Social</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.social.occupancy.html">occupancy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.social.occupancy.occupancy.html">occupancy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lms2.thermal.html">Thermal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.thermal.dipoles.html">dipoles</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lms2.tools.html">Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.tools.data_processing.html">data_processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.tools.data_processing.interpolation.html">interpolation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.tools.data_processing.load_data.html">load_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.tools.data_processing.read_data.html">read_data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.tools.model_processing.html">model_processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.tools.model_processing.construct_objective.html">construct_objective</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.tools.model_processing.fix_binary.html">fix_binary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.tools.model_processing.get_doc.html">get_doc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.tools.model_processing.get_duals.html">get_duals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.tools.model_processing.get_slack.html">get_slack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.tools.model_processing.unfix_binary.html">unfix_binary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../generated/lms2.tools.post_processing.html">post_processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generated/lms2.tools.post_processing.pplot.html">pplot</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../moduleindex.html">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyomo-lmes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../examples.html">Tutorial and Examples</a> &raquo;</li>
      <li>Exemple de gestion d’énergie et de dimensionnement d’un micro-réseau</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/microgrid_1.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Exemple-de-gestion-d’énergie-et-de-dimensionnement-d’un-micro-réseau">
<h1>Exemple de gestion d’énergie et de dimensionnement d’un micro-réseau<a class="headerlink" href="#Exemple-de-gestion-d’énergie-et-de-dimensionnement-d’un-micro-réseau" title="Permalink to this headline"></a></h1>
<p>L’exemple est basé sur la gestion d’énergie et le dimensionneùent d’un micro-réseau contenant, des sources d’énergie renouvelables, des charges, et un système de stockage électrochimique. Le profile d’irradiation et la consomation de la charge sont supposées connues sur l’horizon considéré et les degrés de libertés sont :</p>
<ul class="simple">
<li><p>le dimensionnement du stockage (i.e. c_bat),</p></li>
<li><p>le dimensionnement des panneaux photovoltaïques (i.e. la surface),</p></li>
<li><p>les flux de puissances provenant du réseau et du stockage.</p></li>
</ul>
<p><img alt="34d0bceb7fc744989ef6adefa1535cb9" src="../_images/microgrids_bat.png" /></p>
<p>La première étape consiste à charger les bibliothèques utiles:</p>
<ul class="simple">
<li><p>Pyomo : le package de modélisation des problèmes d’optimisation (voir <a class="reference external" href="https://pyomo.readthedocs.io/en/latest/">https://pyomo.readthedocs.io/en/latest/</a>)</p></li>
<li><p>lms2 : la librairie maison de modèles pour la gestion d’énerge et l’optimisation en génie électrique (documentation dans <code class="docutils literal notranslate"><span class="pre">lms2/docs/_build/html/index.html</span></code>). Dans ce package on ira chercher les modèles que l’on souhaite utiliser, dans le cas qui nous intéresse battery_v2 (avec efficacité en charge et décharge), pv_panel, etc.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pyomo.dae</span> <span class="kn">import</span> <span class="n">ContinuousSet</span><span class="p">,</span> <span class="n">Integral</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">lms2.core.horizon</span> <span class="kn">import</span> <span class="n">SimpleHorizon</span>
<span class="kn">from</span> <span class="nn">lms2.electric.batteries</span> <span class="kn">import</span> <span class="n">battery_v2</span>
<span class="kn">from</span> <span class="nn">lms2.electric.sources</span> <span class="kn">import</span> <span class="n">pv_panel</span><span class="p">,</span> <span class="n">fixed_power_load</span><span class="p">,</span> <span class="n">power_source</span>
</pre></div>
</div>
</div>
<p>Cet exemple d’optimisation illustre les étapes suivantes :</p>
<ol class="arabic simple">
<li><p>Instanciation du problème d’optimisation et de l’horizon temporel</p></li>
<li><p>Discrétisation temporelle</p></li>
<li><p>Chargement des données</p></li>
<li><p>Résolution</p></li>
</ol>
<section id="Instanciation-du-problème-d’optimisation-et-de-l’horizon-temporel">
<h2>Instanciation du problème d’optimisation et de l’horizon temporel<a class="headerlink" href="#Instanciation-du-problème-d’optimisation-et-de-l’horizon-temporel" title="Permalink to this headline"></a></h2>
<p>L’instanciation du problème comporte plusieurs étapes :</p>
<ol class="arabic simple">
<li><p>Instanciation d’un problème nommé <code class="docutils literal notranslate"><span class="pre">m</span></code>.</p></li>
<li><p>Instanciation de l’horizon temporel, celui-ci fait le lien entre les indexes des vecteurs (en s) et les dates (sous forme <code class="docutils literal notranslate"><span class="pre">str</span></code>). Cet objet n’est pas toujours obligatoire, mais il est particulièrement utile pour le chargement de certaines données, la discrétisation temporelle et le post-processing (affichage, etc.).</p></li>
<li><p>Instanciation des variables, des paramètres et des équations du modèle :</p>
<ul class="simple">
<li><p>par chargement de sous-modèles (blocks) déjà existants dans la librairie,</p></li>
<li><p>par modélisation avec le langage pyomo.</p></li>
</ul>
</li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>
<span class="n">horizon</span> <span class="o">=</span> <span class="n">SimpleHorizon</span><span class="p">(</span><span class="n">tstart</span><span class="o">=</span><span class="s1">&#39;2020-01-01 00:00:00&#39;</span><span class="p">,</span> <span class="n">tend</span><span class="o">=</span><span class="s1">&#39;2020-01-02 00:00:00&#39;</span><span class="p">,</span> <span class="n">time_step</span><span class="o">=</span><span class="s1">&#39;10 min&#39;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">ContinuousSet</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizon</span><span class="o">.</span><span class="n">horizon</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;les 5 premiers instants considérés :</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">horizon</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span> <span class="c1">#</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;les 5 premiers indexes (équivalents au temps en s) : </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">horizon</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
les 5 premiers instants considérés :
 DatetimeIndex([&#39;2020-01-01 00:00:00+01:00&#39;, &#39;2020-01-01 00:10:00+01:00&#39;,
               &#39;2020-01-01 00:20:00+01:00&#39;, &#39;2020-01-01 00:30:00+01:00&#39;,
               &#39;2020-01-01 00:40:00+01:00&#39;],
              dtype=&#39;datetime64[ns, Europe/Paris]&#39;, freq=&#39;10T&#39;)
les 5 premiers indexes (équivalents au temps en s) :
 [   0.  600. 1200. 1800. 2400.]
</pre></div></div>
</div>
<p>Les blocks sont des sous-problèmes qui permettent de définir, pour chaque composant, des variables, des paramètres, des contraintes et des expressions.</p>
<p>Il est possible de rentrer des options en argument. Les grandeurs dynamiques seront chargés plus tard, l’utilisation de dictionnaire n’est pas pratique dans ce cas, et le temps n’a pas encore été discrétisé…</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">option_bat</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;c_bat&#39;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="s1">&#39;eta_c&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s1">&#39;eta_d&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s1">&#39;soc_min&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;soc_max&#39;</span><span class="p">:</span> <span class="mi">95</span><span class="p">}</span>
<span class="n">option_charge</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">}</span>
<span class="n">option_pv</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;s_max&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;s_min&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">option_res</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>Les options des blocks sont (généralement) définis dans la documentation de chaque block,</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">help</span><span class="p">(</span><span class="n">battery_v2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on function battery_v2 in module lms2.electric.batteries:

battery_v2(bat, **options)
    Bilinear battery Model.

    This battery is limited in power, variation of power, state of charge and energy. One can fix initial and final
    state of charge.
    Efficiency for charge and discharge are considered.
    It exposes one power port using source convention.

    Instanciation options:
        - c_bat :       battery capacity (kWh)
        - c_bat_max :   battery maximal capacity, default : +inf (only if c_bat is None)
        - c_bat_min :   battery minimal capacity, default : 0 (only if c_bat is None)
        - p_max :       maximal charging power, default : +inf (&gt;0)
        - p_min :       maximal descharging power, default : +inf (&gt;0)
        - soc_min :     minimal soc, default : 0 (&gt;0)
        - soc_max :     maximal soc, default : 100 (&gt;0)
        - soc0 :        initial SOC, default: 50 (0&lt;soc0&lt;100)
        - socf :        final SOC, defalut: 50 (0&lt;socf&lt;100)
        - eta_c :       charging efficiency, default : 1 (&lt;1 and &gt;0)
        - eta_d :       descharging efficiency, default : 1 (&lt;1 and &gt;0)

    =============== ===================================================================
    Variables       Documentation
    =============== ===================================================================
    p               energy derivative with respect to time
    e               energy in battery
    pd              discharging power
    pc              charging power
    u               binary variable
    =============== ===================================================================

    =============== ===================================================================
    Derivative Var  Documentation
    =============== ===================================================================
    de              variation of energy  with respect to time
    dp              variation of the battery power with respect to time
    =============== ===================================================================

    =============== ===================================================================
    Parameters      Documentation
    =============== ===================================================================
    emin            minimum energy (kWh)
    emax            maximal energy
    socmin          minimum soc
    socmax          maximal soc
    soc0            initial state
    socf            final state
    dpdmax          maximal discharging power
    dpcmax          maximal charging power
    pcmax           maximal charging power
    pdmax           maximal discharging power
    etac            charging efficiency
    etad            discharging efficiency
    =============== ===================================================================

    =============== ===================================================================
    Constraints     Documentation
    =============== ===================================================================
    _soc_init       Initial state of charge
    _p_init         Initialize power
    _e_min          Minimal energy constraint
    _e_max          Maximal energy constraint
    _soc_final      Final soc constraint
    _soc_min        Minimal state of charge constraint
    _soc_max        Maximal state of charge constraint
    _dpdmax         Maximal varation of descharging power constraint
    _dpcmax         Maximal varation of charging power constraint
    _pdmax          Discharging power bound
    _pcmax          Charging power bound
    _p_balance      Power balance constraint
    _e_balance      Energy balance constraint
    =============== ===================================================================

    =============== ===================================================================
    Ports           Documentation
    =============== ===================================================================
    outlet          output power of the battery (kW), using source convention
    =============== ===================================================================

    =============== ===================================================================
    Expressions     Documentation
    =============== ===================================================================
    soc             Expression of the state of charge
    =============== ===================================================================

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m</span><span class="o">.</span><span class="n">bat</span> <span class="o">=</span> <span class="n">Block</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">battery_v2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">option_bat</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">Block</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">fixed_power_load</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">option_charge</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">pv</span> <span class="o">=</span> <span class="n">Block</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pv_panel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">option_pv</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="n">Block</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">power_source</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">option_res</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>A ce stade, les blocks sont instancié dans le problème <code class="docutils literal notranslate"><span class="pre">m</span></code>. Il est possible de vérifier la structure du modèle avec la commande <code class="docutils literal notranslate"><span class="pre">pprint()</span></code>. Notez que certaines grandeurs ne sont pas initialisées à la valeur que l’on souhaiterait, pour le moment.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m</span><span class="o">.</span><span class="n">bat</span><span class="o">.</span><span class="n">pprint</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
bat : Size=1, Index=None, Active=True
    13 Param Declarations
        dpcmax : maximal charging power
            Size=1, Index=None, Domain=Reals, Default=10000000.0, Mutable=True
            Key  : Value
            None : 10000000.0
        dpdmax : maximal discharging power
            Size=1, Index=None, Domain=Reals, Default=10000000.0, Mutable=True
            Key  : Value
            None : 10000000.0
        emax : maximal energy
            Size=1, Index=None, Domain=Reals, Default=2000, Mutable=True
            Key  : Value
            None :  2000
        emin : minimum energy (kWh)
            Size=1, Index=None, Domain=NonNegativeReals, Default=0, Mutable=True
            Key  : Value
            None :     0
        etac : charging efficiency
            Size=1, Index=None, Domain=Reals, Default=0.95, Mutable=True
            Key : Value
        etad : discharging efficiency
            Size=1, Index=None, Domain=Reals, Default=0.95, Mutable=True
            Key : Value
        pcmax : maximal charging power
            Size=1, Index=None, Domain=NonNegativeReals, Default=10000000.0, Mutable=True
            Key  : Value
            None : 10000000.0
        pdmax : maximal discharging power
            Size=1, Index=None, Domain=NonNegativeReals, Default=10000000.0, Mutable=True
            Key  : Value
            None : 10000000.0
        pinit : initial output power of the battery (default : None)
            Size=1, Index=None, Domain=Any, Default=None, Mutable=True
            Key  : Value
            None :  None
        soc0 : initial state
            Size=1, Index=None, Domain=Any, Default=50, Mutable=True
            Key  : Value
            None :    50
        socf : final state
            Size=1, Index=None, Domain=Any, Default=50, Mutable=True
            Key  : Value
            None :    50
        socmax : maximal soc
            Size=1, Index=None, Domain=Any, Default=95, Mutable=True
            Key  : Value
            None :    95
        socmin : minimum soc
            Size=1, Index=None, Domain=Reals, Default=40, Mutable=True
            Key  : Value
            None :    40

    5 Var Declarations
        e : energy in battery
            Size=2, Index=time
            Key     : Lower : Value  : Upper : Fixed : Stale : Domain
                  0 :     0 : 1000.0 :  2000 : False : False :  Reals
            86400.0 :     0 : 1000.0 :  2000 : False : False :  Reals
        p : energy derivative with respect to time
            Size=2, Index=time
            Key     : Lower : Value : Upper : Fixed : Stale : Domain
                  0 :  None :     0 :  None : False : False :  Reals
            86400.0 :  None :     0 :  None : False : False :  Reals
        pc : charging power
            Size=2, Index=time
            Key     : Lower : Value : Upper : Fixed : Stale : Domain
                  0 :     0 :     0 :  None : False : False : NonNegativeReals
            86400.0 :     0 :     0 :  None : False : False : NonNegativeReals
        pd : discharging power
            Size=2, Index=time
            Key     : Lower : Value : Upper : Fixed : Stale : Domain
                  0 :     0 :     0 :  None : False : False : NonNegativeReals
            86400.0 :     0 :     0 :  None : False : False : NonNegativeReals
        u : binary variable
            Size=2, Index=time
            Key     : Lower : Value : Upper : Fixed : Stale : Domain
                  0 :     0 :     0 :     1 : False : False : Binary
            86400.0 :     0 :     0 :     1 : False : False : Binary

    1 Expression Declarations
        soc : Expression of the state of charge
            Size=2, Index=time
            Key     : Expression
                  0 :       100*bat.e[0]/bat.emax
            86400.0 : 100*bat.e[86400.0]/bat.emax

    13 Constraint Declarations
        _dpcmax : Maximal variation of charging power constraint
            Size=2, Index=time, Active=True
            Key     : Lower        : Body            : Upper : Active
                  0 : - bat.dpcmax :       bat.dp[0] :  +Inf :   True
            86400.0 : - bat.dpcmax : bat.dp[86400.0] :  +Inf :   True
        _dpdmax : Maximal variation of descharging power constraint
            Size=2, Index=time, Active=True
            Key     : Lower : Body            : Upper      : Active
                  0 :  -Inf :       bat.dp[0] : bat.dpdmax :   True
            86400.0 :  -Inf : bat.dp[86400.0] : bat.dpdmax :   True
        _e_balance : Energy balance constraint
            Size=2, Index=time, Active=True
            Key     : Lower : Body                                                                                            : Upper : Active
                  0 :   0.0 :                   bat.de[0] - 0.0002777777777777778*(bat.etac*bat.pc[0] - 1/bat.etad*bat.pd[0]) :   0.0 :   True
            86400.0 :   0.0 : bat.de[86400.0] - 0.0002777777777777778*(bat.etac*bat.pc[86400.0] - 1/bat.etad*bat.pd[86400.0]) :   0.0 :   True
        _e_max : Maximal energy constraint
            Size=2, Index=time, Active=True
            Key     : Lower : Body           : Upper    : Active
                  0 :  -Inf :       bat.e[0] : bat.emax :   True
            86400.0 :  -Inf : bat.e[86400.0] : bat.emax :   True
        _e_min : Minimal energy constraint
            Size=2, Index=time, Active=True
            Key     : Lower    : Body           : Upper : Active
                  0 : bat.emin :       bat.e[0] :  +Inf :   True
            86400.0 : bat.emin : bat.e[86400.0] :  +Inf :   True
        _p_balance : Power balance constraint
            Size=2, Index=time, Active=True
            Key     : Lower : Body                                               : Upper : Active
                  0 :   0.0 :                   bat.p[0] - bat.pd[0] + bat.pc[0] :   0.0 :   True
            86400.0 :   0.0 : bat.p[86400.0] - bat.pd[86400.0] + bat.pc[86400.0] :   0.0 :   True
        _p_init : Initialize power
            Size=0, Index=time, Active=True
            Key : Lower : Body : Upper : Active
        _pcmax : Charging power bound
            Size=2, Index=time, Active=True
            Key     : Lower : Body                                       : Upper     : Active
                  0 :  -Inf :             bat.pc[0] + bat.pcmax*bat.u[0] : bat.pcmax :   True
            86400.0 :  -Inf : bat.pc[86400.0] + bat.pcmax*bat.u[86400.0] : bat.pcmax :   True
        _pdmax : Discharging power bound
            Size=2, Index=time, Active=True
            Key     : Lower : Body                                       : Upper : Active
                  0 :  -Inf :             bat.pd[0] - bat.pdmax*bat.u[0] :   0.0 :   True
            86400.0 :  -Inf : bat.pd[86400.0] - bat.pdmax*bat.u[86400.0] :   0.0 :   True
        _soc_final : Final soc constraint
            Size=1, Index=time, Active=True
            Key     : Lower                 : Body           : Upper                 : Active
            86400.0 : bat.socf*bat.emax/100 : bat.e[86400.0] : bat.socf*bat.emax/100 :   True
        _soc_init : initial state of charge
            Size=1, Index=time, Active=True
            Key : Lower                 : Body     : Upper                 : Active
              0 : bat.soc0*bat.emax/100 : bat.e[0] : bat.soc0*bat.emax/100 :   True
        _soc_max : Maximal state of charge constraint
            Size=2, Index=time, Active=True
            Key     : Lower : Body           : Upper                   : Active
                  0 :  -Inf :       bat.e[0] : bat.emax*bat.socmax/100 :   True
            86400.0 :  -Inf : bat.e[86400.0] : bat.emax*bat.socmax/100 :   True
        _soc_min : Minimal state of charge constraint
            Size=2, Index=time, Active=True
            Key     : Lower                   : Body           : Upper : Active
                  0 : bat.socmin*bat.emax/100 :       bat.e[0] :  +Inf :   True
            86400.0 : bat.socmin*bat.emax/100 : bat.e[86400.0] :  +Inf :   True

    2 DerivativeVar Declarations
        de : variation of energy  with respect to time
            Size=2, Index=time
            Key     : Lower : Value : Upper : Fixed : Stale : Domain
                  0 :  None :     0 :  None : False : False :  Reals
            86400.0 :  None :     0 :  None : False : False :  Reals
        dp : variation of the battery power with respect to time
            Size=2, Index=time
            Key     : Lower       : Value : Upper      : Fixed : Stale : Domain
                  0 : -10000000.0 :     0 : 10000000.0 : False : False :  Reals
            86400.0 : -10000000.0 :     0 : 10000000.0 : False : False :  Reals

    1 Port Declarations
        outlet : output power of the battery (kW), using source convention
            Size=1, Index=None
            Key  : Name : Size : Variable
            None :    f :    2 :    bat.p

    35 Declarations: emax emin socmin pinit socmax soc0 socf dpdmax dpcmax pcmax pdmax p e de dp outlet _soc_init _p_init _e_min _e_max _soc_final _soc_min _soc_max _dpdmax _dpcmax soc pd pc u etac etad _e_balance _pdmax _pcmax _p_balance
</pre></div></div>
</div>
<section id="Exemple-de-contrainte-sur-le-bilan-de-puissance">
<h3>Exemple de contrainte sur le bilan de puissance<a class="headerlink" href="#Exemple-de-contrainte-sur-le-bilan-de-puissance" title="Permalink to this headline"></a></h3>
<p>La connexion électrique des blocks entre eux peut être vue comme une contrainte d’égalité, appelée bilan de puissance. Elle doit être définie en dehors des blocks, (i.e. au niveau du model m). Pour se faire il y a deux possibilités : - définir une contrainte classique avec le langague de pyomo, - utiliser la notion de ports (extensifs ou intensifs) (usage un peu plus avancé).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bilan_puissance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">bat</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">pv</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">charge</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Exemple-d’une-expression">
<h3>Exemple d’une expression<a class="headerlink" href="#Exemple-d’une-expression" title="Permalink to this headline"></a></h3>
<p>Il est possible de définir des expressions, qui interviendront potentiellement dans les calculs des coûts, des contraintes ou pour le post-processing. Pour l’exemple, définissons les couts instantanés économiques <code class="docutils literal notranslate"><span class="pre">cout_inst_edf</span></code> et écologiques <code class="docutils literal notranslate"><span class="pre">cout_inst_env</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nd">@m</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cout_inst_env</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">60</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">bat</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">pv</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="mi">700</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>


<span class="nd">@m</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cout_inst_edf</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.15</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Exemple-d’intégration-temporelle">
<h3>Exemple d’intégration temporelle<a class="headerlink" href="#Exemple-d’intégration-temporelle" title="Permalink to this headline"></a></h3>
<p>Lorsqu’une expression doit être intégrée sur le temps continu, on utilise l’objet <code class="docutils literal notranslate"><span class="pre">Integral</span></code>. L’intégration des couts sur le temps devient :</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m</span><span class="o">.</span><span class="n">int_edf</span> <span class="o">=</span> <span class="n">Integral</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">cout_inst_edf</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">int_env</span> <span class="o">=</span> <span class="n">Integral</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">cout_inst_env</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Exemple-de-définition-de-l’objectif">
<h3>Exemple de définition de l’objectif<a class="headerlink" href="#Exemple-de-définition-de-l’objectif" title="Permalink to this headline"></a></h3>
<p>L’objectif d’optimisation doit être défini au niveau du model <code class="docutils literal notranslate"><span class="pre">m</span></code> et peut faire intervenir les variables des sous-blocks. Dans le language Pyomo, on utilise l’objet <code class="docutils literal notranslate"><span class="pre">Objective</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">cout_edf</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">int_edf</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">bat</span><span class="o">.</span><span class="n">emax</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">last</span><span class="p">()</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">first</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">pv</span><span class="o">.</span><span class="n">s_pv</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">last</span><span class="p">()</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">first</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Discrétisation-temporelle">
<h2>Discrétisation temporelle<a class="headerlink" href="#Discrétisation-temporelle" title="Permalink to this headline"></a></h2>
<p>La discrétisation temporelle est souvent source d’erreur, suivant le schéma d’intégration et sur des modèles de grande taille, cette étape devient difficilement réalisable à la main. Pour cela, l’extention Pyomo.dae offre la possibilité de discrétiser automatiquement les modèles dans lesquels apparait un index continu (généralement le temps). Ce qui rend les choses plus simples. Dans cet exemple on choisira un schéma d’intégration de différence finie (i.e. celui d’Euler).</p>
<p>Avant discrétisation, les grandeurs indexées par le temps ne font intervenir que le début et la fin de l’horizon.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># l&#39;intégrale avant discrétisation :</span>
<span class="n">m</span><span class="o">.</span><span class="n">int_edf</span><span class="o">.</span><span class="n">pprint</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
int_edf : Size=1, Index=None
    Key  : Expression
    None : 43200.0*(0.15*res.p[86400.0] + 0.15*res.p[0])
</pre></div></div>
</div>
<p>Noter que la discrétisation se fait sur le modèle complet, en renseignant le nombre d’éléments finis. Dans notre cas, cette information est stockée dans l’objet <code class="docutils literal notranslate"><span class="pre">horizon</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="n">TransformationFactory</span>
<span class="n">TransformationFactory</span><span class="p">(</span><span class="s1">&#39;dae.finite_difference&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply_to</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nfe</span><span class="o">=</span><span class="n">horizon</span><span class="o">.</span><span class="n">nfe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># l&#39;intégrale après discrétisation :</span>
<span class="n">m</span><span class="o">.</span><span class="n">int_edf</span><span class="o">.</span><span class="n">pprint</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
int_edf : Size=1, Index=None
    Key  : Expression
    None : 300.0*(0.15*res.p[600.0] + 0.15*res.p[0]) + 300.0*(0.15*res.p[1200.0] + 0.15*res.p[600.0]) + 300.0*(0.15*res.p[1800.0] + 0.15*res.p[1200.0]) + 300.0*(0.15*res.p[2400.0] + 0.15*res.p[1800.0]) + 300.0*(0.15*res.p[3000.0] + 0.15*res.p[2400.0]) + 300.0*(0.15*res.p[3600.0] + 0.15*res.p[3000.0]) + 300.0*(0.15*res.p[4200.0] + 0.15*res.p[3600.0]) + 300.0*(0.15*res.p[4800.0] + 0.15*res.p[4200.0]) + 300.0*(0.15*res.p[5400.0] + 0.15*res.p[4800.0]) + 300.0*(0.15*res.p[6000.0] + 0.15*res.p[5400.0]) + 300.0*(0.15*res.p[6600.0] + 0.15*res.p[6000.0]) + 300.0*(0.15*res.p[7200.0] + 0.15*res.p[6600.0]) + 300.0*(0.15*res.p[7800.0] + 0.15*res.p[7200.0]) + 300.0*(0.15*res.p[8400.0] + 0.15*res.p[7800.0]) + 300.0*(0.15*res.p[9000.0] + 0.15*res.p[8400.0]) + 300.0*(0.15*res.p[9600.0] + 0.15*res.p[9000.0]) + 300.0*(0.15*res.p[10200.0] + 0.15*res.p[9600.0]) + 300.0*(0.15*res.p[10800.0] + 0.15*res.p[10200.0]) + 300.0*(0.15*res.p[11400.0] + 0.15*res.p[10800.0]) + 300.0*(0.15*res.p[12000.0] + 0.15*res.p[11400.0]) + 300.0*(0.15*res.p[12600.0] + 0.15*res.p[12000.0]) + 300.0*(0.15*res.p[13200.0] + 0.15*res.p[12600.0]) + 300.0*(0.15*res.p[13800.0] + 0.15*res.p[13200.0]) + 300.0*(0.15*res.p[14400.0] + 0.15*res.p[13800.0]) + 300.0*(0.15*res.p[15000.0] + 0.15*res.p[14400.0]) + 300.0*(0.15*res.p[15600.0] + 0.15*res.p[15000.0]) + 300.0*(0.15*res.p[16200.0] + 0.15*res.p[15600.0]) + 300.0*(0.15*res.p[16800.0] + 0.15*res.p[16200.0]) + 300.0*(0.15*res.p[17400.0] + 0.15*res.p[16800.0]) + 300.0*(0.15*res.p[18000.0] + 0.15*res.p[17400.0]) + 300.0*(0.15*res.p[18600.0] + 0.15*res.p[18000.0]) + 300.0*(0.15*res.p[19200.0] + 0.15*res.p[18600.0]) + 300.0*(0.15*res.p[19800.0] + 0.15*res.p[19200.0]) + 300.0*(0.15*res.p[20400.0] + 0.15*res.p[19800.0]) + 300.0*(0.15*res.p[21000.0] + 0.15*res.p[20400.0]) + 300.0*(0.15*res.p[21600.0] + 0.15*res.p[21000.0]) + 300.0*(0.15*res.p[22200.0] + 0.15*res.p[21600.0]) + 300.0*(0.15*res.p[22800.0] + 0.15*res.p[22200.0]) + 300.0*(0.15*res.p[23400.0] + 0.15*res.p[22800.0]) + 300.0*(0.15*res.p[24000.0] + 0.15*res.p[23400.0]) + 300.0*(0.15*res.p[24600.0] + 0.15*res.p[24000.0]) + 300.0*(0.15*res.p[25200.0] + 0.15*res.p[24600.0]) + 300.0*(0.15*res.p[25800.0] + 0.15*res.p[25200.0]) + 300.0*(0.15*res.p[26400.0] + 0.15*res.p[25800.0]) + 300.0*(0.15*res.p[27000.0] + 0.15*res.p[26400.0]) + 300.0*(0.15*res.p[27600.0] + 0.15*res.p[27000.0]) + 300.0*(0.15*res.p[28200.0] + 0.15*res.p[27600.0]) + 300.0*(0.15*res.p[28800.0] + 0.15*res.p[28200.0]) + 300.0*(0.15*res.p[29400.0] + 0.15*res.p[28800.0]) + 300.0*(0.15*res.p[30000.0] + 0.15*res.p[29400.0]) + 300.0*(0.15*res.p[30600.0] + 0.15*res.p[30000.0]) + 300.0*(0.15*res.p[31200.0] + 0.15*res.p[30600.0]) + 300.0*(0.15*res.p[31800.0] + 0.15*res.p[31200.0]) + 300.0*(0.15*res.p[32400.0] + 0.15*res.p[31800.0]) + 300.0*(0.15*res.p[33000.0] + 0.15*res.p[32400.0]) + 300.0*(0.15*res.p[33600.0] + 0.15*res.p[33000.0]) + 300.0*(0.15*res.p[34200.0] + 0.15*res.p[33600.0]) + 300.0*(0.15*res.p[34800.0] + 0.15*res.p[34200.0]) + 300.0*(0.15*res.p[35400.0] + 0.15*res.p[34800.0]) + 300.0*(0.15*res.p[36000.0] + 0.15*res.p[35400.0]) + 300.0*(0.15*res.p[36600.0] + 0.15*res.p[36000.0]) + 300.0*(0.15*res.p[37200.0] + 0.15*res.p[36600.0]) + 300.0*(0.15*res.p[37800.0] + 0.15*res.p[37200.0]) + 300.0*(0.15*res.p[38400.0] + 0.15*res.p[37800.0]) + 300.0*(0.15*res.p[39000.0] + 0.15*res.p[38400.0]) + 300.0*(0.15*res.p[39600.0] + 0.15*res.p[39000.0]) + 300.0*(0.15*res.p[40200.0] + 0.15*res.p[39600.0]) + 300.0*(0.15*res.p[40800.0] + 0.15*res.p[40200.0]) + 300.0*(0.15*res.p[41400.0] + 0.15*res.p[40800.0]) + 300.0*(0.15*res.p[42000.0] + 0.15*res.p[41400.0]) + 300.0*(0.15*res.p[42600.0] + 0.15*res.p[42000.0]) + 300.0*(0.15*res.p[43200.0] + 0.15*res.p[42600.0]) + 300.0*(0.15*res.p[43800.0] + 0.15*res.p[43200.0]) + 300.0*(0.15*res.p[44400.0] + 0.15*res.p[43800.0]) + 300.0*(0.15*res.p[45000.0] + 0.15*res.p[44400.0]) + 300.0*(0.15*res.p[45600.0] + 0.15*res.p[45000.0]) + 300.0*(0.15*res.p[46200.0] + 0.15*res.p[45600.0]) + 300.0*(0.15*res.p[46800.0] + 0.15*res.p[46200.0]) + 300.0*(0.15*res.p[47400.0] + 0.15*res.p[46800.0]) + 300.0*(0.15*res.p[48000.0] + 0.15*res.p[47400.0]) + 300.0*(0.15*res.p[48600.0] + 0.15*res.p[48000.0]) + 300.0*(0.15*res.p[49200.0] + 0.15*res.p[48600.0]) + 300.0*(0.15*res.p[49800.0] + 0.15*res.p[49200.0]) + 300.0*(0.15*res.p[50400.0] + 0.15*res.p[49800.0]) + 300.0*(0.15*res.p[51000.0] + 0.15*res.p[50400.0]) + 300.0*(0.15*res.p[51600.0] + 0.15*res.p[51000.0]) + 300.0*(0.15*res.p[52200.0] + 0.15*res.p[51600.0]) + 300.0*(0.15*res.p[52800.0] + 0.15*res.p[52200.0]) + 300.0*(0.15*res.p[53400.0] + 0.15*res.p[52800.0]) + 300.0*(0.15*res.p[54000.0] + 0.15*res.p[53400.0]) + 300.0*(0.15*res.p[54600.0] + 0.15*res.p[54000.0]) + 300.0*(0.15*res.p[55200.0] + 0.15*res.p[54600.0]) + 300.0*(0.15*res.p[55800.0] + 0.15*res.p[55200.0]) + 300.0*(0.15*res.p[56400.0] + 0.15*res.p[55800.0]) + 300.0*(0.15*res.p[57000.0] + 0.15*res.p[56400.0]) + 300.0*(0.15*res.p[57600.0] + 0.15*res.p[57000.0]) + 300.0*(0.15*res.p[58200.0] + 0.15*res.p[57600.0]) + 300.0*(0.15*res.p[58800.0] + 0.15*res.p[58200.0]) + 300.0*(0.15*res.p[59400.0] + 0.15*res.p[58800.0]) + 300.0*(0.15*res.p[60000.0] + 0.15*res.p[59400.0]) + 300.0*(0.15*res.p[60600.0] + 0.15*res.p[60000.0]) + 300.0*(0.15*res.p[61200.0] + 0.15*res.p[60600.0]) + 300.0*(0.15*res.p[61800.0] + 0.15*res.p[61200.0]) + 300.0*(0.15*res.p[62400.0] + 0.15*res.p[61800.0]) + 300.0*(0.15*res.p[63000.0] + 0.15*res.p[62400.0]) + 300.0*(0.15*res.p[63600.0] + 0.15*res.p[63000.0]) + 300.0*(0.15*res.p[64200.0] + 0.15*res.p[63600.0]) + 300.0*(0.15*res.p[64800.0] + 0.15*res.p[64200.0]) + 300.0*(0.15*res.p[65400.0] + 0.15*res.p[64800.0]) + 300.0*(0.15*res.p[66000.0] + 0.15*res.p[65400.0]) + 300.0*(0.15*res.p[66600.0] + 0.15*res.p[66000.0]) + 300.0*(0.15*res.p[67200.0] + 0.15*res.p[66600.0]) + 300.0*(0.15*res.p[67800.0] + 0.15*res.p[67200.0]) + 300.0*(0.15*res.p[68400.0] + 0.15*res.p[67800.0]) + 300.0*(0.15*res.p[69000.0] + 0.15*res.p[68400.0]) + 300.0*(0.15*res.p[69600.0] + 0.15*res.p[69000.0]) + 300.0*(0.15*res.p[70200.0] + 0.15*res.p[69600.0]) + 300.0*(0.15*res.p[70800.0] + 0.15*res.p[70200.0]) + 300.0*(0.15*res.p[71400.0] + 0.15*res.p[70800.0]) + 300.0*(0.15*res.p[72000.0] + 0.15*res.p[71400.0]) + 300.0*(0.15*res.p[72600.0] + 0.15*res.p[72000.0]) + 300.0*(0.15*res.p[73200.0] + 0.15*res.p[72600.0]) + 300.0*(0.15*res.p[73800.0] + 0.15*res.p[73200.0]) + 300.0*(0.15*res.p[74400.0] + 0.15*res.p[73800.0]) + 300.0*(0.15*res.p[75000.0] + 0.15*res.p[74400.0]) + 300.0*(0.15*res.p[75600.0] + 0.15*res.p[75000.0]) + 300.0*(0.15*res.p[76200.0] + 0.15*res.p[75600.0]) + 300.0*(0.15*res.p[76800.0] + 0.15*res.p[76200.0]) + 300.0*(0.15*res.p[77400.0] + 0.15*res.p[76800.0]) + 300.0*(0.15*res.p[78000.0] + 0.15*res.p[77400.0]) + 300.0*(0.15*res.p[78600.0] + 0.15*res.p[78000.0]) + 300.0*(0.15*res.p[79200.0] + 0.15*res.p[78600.0]) + 300.0*(0.15*res.p[79800.0] + 0.15*res.p[79200.0]) + 300.0*(0.15*res.p[80400.0] + 0.15*res.p[79800.0]) + 300.0*(0.15*res.p[81000.0] + 0.15*res.p[80400.0]) + 300.0*(0.15*res.p[81600.0] + 0.15*res.p[81000.0]) + 300.0*(0.15*res.p[82200.0] + 0.15*res.p[81600.0]) + 300.0*(0.15*res.p[82800.0] + 0.15*res.p[82200.0]) + 300.0*(0.15*res.p[83400.0] + 0.15*res.p[82800.0]) + 300.0*(0.15*res.p[84000.0] + 0.15*res.p[83400.0]) + 300.0*(0.15*res.p[84600.0] + 0.15*res.p[84000.0]) + 300.0*(0.15*res.p[85200.0] + 0.15*res.p[84600.0]) + 300.0*(0.15*res.p[85800.0] + 0.15*res.p[85200.0]) + 300.0*(0.15*res.p[86400.0] + 0.15*res.p[85800.0])
</pre></div></div>
</div>
</section>
<section id="Chargement-des-données">
<h2>Chargement des données<a class="headerlink" href="#Chargement-des-données" title="Permalink to this headline"></a></h2>
<p>En optimisation, il est d’usage de séparer la formulation des données, pour une meilleure lecture et pour réutiliser simplement les modèles.</p>
<p>La lecture et le chargement des données peuvent-être réalisées par différentes méthodes selon les formats des données. Dans lms2, nous proposons une forme générique de lire, interpoler et charger les données en utilisant les fonctions <code class="docutils literal notranslate"><span class="pre">lms2.tools.read_data</span></code> et <code class="docutils literal notranslate"><span class="pre">lms2.load_data</span></code>. Se référer aux documentations pour plus d’information.</p>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">read_data</span></code> gère plusieurs formats de données, ou plutôt, pluseurs formats d’index.</p>
<section id="Index-entier">
<h3>Index entier<a class="headerlink" href="#Index-entier" title="Permalink to this headline"></a></h3>
<p>Si les données sont indexées par une colonne en seconde. L’unité utilisée peut-être renseignée (par défaut ‘s’), la zone peut-être renseignée (défaut : Europe/Paris), et la date de début des données doit être renseignée. Cet index est ensuite automatiquement transformé en date.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">lms2.tools.data_processing</span> <span class="kn">import</span> <span class="n">read_data</span><span class="p">,</span> <span class="n">load_data</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">data_charge</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="n">horizon</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;base_loads.csv&#39;</span><span class="p">),</span>
                        <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                        <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                        <span class="n">tz_data</span><span class="o">=</span> <span class="s1">&#39;Europe/Paris&#39;</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="o">=</span><span class="s1">&#39;2020-01-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">data_charge</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>base_load1</th>
      <th>base_load2</th>
      <th>base_load3</th>
      <th>time (s)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-01 00:00:00+01:00</th>
      <td>191.699997</td>
      <td>29.0</td>
      <td>319.552185</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-01-01 00:10:00+01:00</th>
      <td>191.699997</td>
      <td>29.0</td>
      <td>288.000000</td>
      <td>600</td>
    </tr>
    <tr>
      <th>2020-01-01 00:20:00+01:00</th>
      <td>191.699997</td>
      <td>29.0</td>
      <td>443.000000</td>
      <td>1200</td>
    </tr>
    <tr>
      <th>2020-01-01 00:30:00+01:00</th>
      <td>191.699997</td>
      <td>29.0</td>
      <td>443.000000</td>
      <td>1800</td>
    </tr>
    <tr>
      <th>2020-01-01 00:40:00+01:00</th>
      <td>191.699997</td>
      <td>153.0</td>
      <td>215.399994</td>
      <td>2400</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">data_charge</span><span class="p">[[</span><span class="s1">&#39;base_load1&#39;</span><span class="p">,</span> <span class="s1">&#39;base_load2&#39;</span><span class="p">,</span> <span class="s1">&#39;base_load3&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                                                             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Trois profils de puissance de la charge (kW)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_microgrid_1_28_0.png" src="../_images/examples_microgrid_1_28_0.png" />
</div>
</div>
</section>
<section id="Index-en-chaîne-de-caractères">
<h3>Index en chaîne de caractères<a class="headerlink" href="#Index-en-chaîne-de-caractères" title="Permalink to this headline"></a></h3>
<p>Si les données sont indexées par une chaine de caractère dont le format est celui d’une date. Dans ce cas, la date de début et l’unité ne sont pas utiles. La colonne d’index est parsée, utilisant le format définit dans date_parser.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data_pv</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="n">horizon</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;pv_2020.csv&#39;</span><span class="p">),</span>
                    <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">date_parser</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M&quot;</span><span class="p">)</span>

<span class="n">data_pv</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p_PV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-01 00:00:00+01:00</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2020-01-01 00:10:00+01:00</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2020-01-01 00:20:00+01:00</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2020-01-01 00:30:00+01:00</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2020-01-01 00:40:00+01:00</th>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data_pv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Profil de puissance des PV&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_microgrid_1_31_0.png" src="../_images/examples_microgrid_1_31_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">load_data</span><span class="p">(</span><span class="n">horizon</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">pv</span><span class="o">.</span><span class="n">p0</span><span class="p">,</span> <span class="n">data_pv</span><span class="p">[</span><span class="s1">&#39;p_PV&#39;</span><span class="p">])</span>
<span class="n">load_data</span><span class="p">(</span><span class="n">horizon</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">charge</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">data_charge</span><span class="p">[</span><span class="s1">&#39;base_load1&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
data index and variable index does not have the same name. This could be a source of error...
data index and variable index does not have the same name. This could be a source of error...
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">type</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">pv</span><span class="o">.</span><span class="n">p0</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
pyomo.core.base.param.IndexedParam
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># solver</span>
<span class="c1">#sol = SolverFactory(&#39;gurobi&#39;, solver_io=&quot;direct&quot;)</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;glpk&#39;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># post-processing</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">lms2.tools.post_processing</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">pplot</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">bat</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">pv</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">charge</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
      <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Bilan de Puissance&#39;</span><span class="p">,</span>
      <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
      <span class="n">index</span><span class="o">=</span><span class="n">horizon</span><span class="o">.</span><span class="n">current</span><span class="p">,</span>
      <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>

<span class="n">pplot</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">pv</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">pv</span><span class="o">.</span><span class="n">p0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Puissance PV&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">horizon</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
<span class="n">pplot</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">bat</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Etat de charge Batterie&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">horizon</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
<span class="n">pplot</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">cout_inst_edf</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Cout EDF instantané&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">horizon</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_microgrid_1_35_0.png" src="../_images/examples_microgrid_1_35_0.png" />
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../examples_lms2.html" class="btn btn-neutral float-left" title="Working with pyomo-lmes library components" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="battery_piecewise_charging_limits.html" class="btn btn-neutral float-right" title="Modeling battery with maximal charging power limit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015-2023, lms2 Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>