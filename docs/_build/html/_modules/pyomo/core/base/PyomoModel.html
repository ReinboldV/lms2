

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyomo.core.base.PyomoModel &mdash; lms2 0.1.2+32.gf7f6da3.dirty documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> lms2
          

          
            
            <img src="../../../../_static/Logo-UPSUD_2014_UPSaclay-BLEU.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Tutorial Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples.html#working-with-lms2-library-components">Working with lms2 library components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#example-of-model-by-aggregating-blocks-of-the-library">1) Example of model by aggregating blocks of the library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#example-of-a-block">2) Example of a block</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples.html#working-with-pyomo">Working with Pyomo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#simple-example-using-pyomo-language">1) Simple example using pyomo language</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#working-with-abstract-model">2) working with abstract model</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../builddoc.html">How to build the documentation ?</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../lms2.html">Library (lms2)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../lms2.base.html">Base (lms2.base)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.base.base_units.html">base_units</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.bound_profile.html">lms2.base.base_units.bound_profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.fix_profile.html">lms2.base.base_units.fix_profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.set_profile.html">lms2.base.base_units.set_profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.Abs.html">Abs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.AbsDynUnit.html">AbsDynUnit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.AbsEffortSource.html">AbsEffortSource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.AbsFixedFlowLoad.html">AbsFixedFlowLoad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.AbsFixedFlowSource.html">AbsFixedFlowSource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.AbsFlowLoad.html">AbsFlowLoad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.AbsFlowSource.html">AbsFlowSource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.DynUnit.html">DynUnit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.DynUnitTest.html">DynUnitTest</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.EffortSource.html">EffortSource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.FlowLoad.html">FlowLoad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.FlowSource.html">FlowSource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.ScalableFlowSource.html">ScalableFlowSource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.SourceUnit.html">SourceUnit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.SourceUnitParam.html">SourceUnitParam</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.Storage.html">Storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.base_units.UnitA.html">UnitA</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.base.utils.html">utils</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.base.utils.pplot.html">lms2.base.utils.pplot</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../lms2.core.html">Core (lms2.core)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.core.models.html">models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.core.models.AbsLModel.html">AbsLModel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.core.models.LModel.html">LModel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.core.time.html">time</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.core.time.Time.html">Time</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.core.units.html">units</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.core.units.Unit.html">Unit</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../lms2.economic.html">Economic (lms2.economic)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.economic.cost.html">cost</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.economic.cost.buying_cost.html">lms2.economic.cost.buying_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.economic.cost.def_absolute_cost.html">lms2.economic.cost.def_absolute_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.economic.cost.def_bilinear_cost.html">lms2.economic.cost.def_bilinear_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.economic.cost.def_bilinear_dynamic_cost.html">lms2.economic.cost.def_bilinear_dynamic_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.economic.cost.def_linear_cost.html">lms2.economic.cost.def_linear_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.economic.cost.def_linear_dyn_cost.html">lms2.economic.cost.def_linear_dyn_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.economic.cost.maintenance_cost.html">lms2.economic.cost.maintenance_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.economic.cost.recycling_cost.html">lms2.economic.cost.recycling_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.economic.cost.replacement_cost.html">lms2.economic.cost.replacement_cost</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../lms2.electric.html">Electric (lms2.electric)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.electric.abs_batteries.html">abs_batteries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_batteries.AbsBatteryV0.html">AbsBatteryV0</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_batteries.AbsBatteryV1.html">AbsBatteryV1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_batteries.AbsBatteryV2.html">AbsBatteryV2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_batteries.AbsNLBattery.html">AbsNLBattery</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.electric.abs_maingrids.html">abs_maingrids</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_maingrids.def_pin_pout.html">lms2.electric.abs_maingrids.def_pin_pout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_maingrids.AbsMainGridV0.html">AbsMainGridV0</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_maingrids.AbsMainGridV1.html">AbsMainGridV1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_maingrids.AbsMainGridV2.html">AbsMainGridV2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_maingrids.AbsMainGrid_old.html">AbsMainGrid_old</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.electric.abs_sources.html">abs_sources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_sources.AbsDebugSource.html">AbsDebugSource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_sources.AbsFixedPowerLoad.html">AbsFixedPowerLoad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_sources.AbsFixedPowerSource.html">AbsFixedPowerSource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_sources.AbsPowerLoad.html">AbsPowerLoad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_sources.AbsPowerSource.html">AbsPowerSource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_sources.AbsProgrammableLoad.html">AbsProgrammableLoad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_sources.AbsScalablePowerLoad.html">AbsScalablePowerLoad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.electric.abs_sources.AbsScalablePowerSource.html">AbsScalablePowerSource</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../lms2.environment.html">Environment (lms2.environment)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.environment.ghg.html">ghg</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.environment.ghg.def_linear_ghg_cost.html">lms2.environment.ghg.def_linear_ghg_cost</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../lms2.fluids.html">Fluids (lms2.fluids)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.fluids.modelCO2.html">modelCO2</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.fluids.modelCO2.ModelCO2.html">ModelCO2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.fluids.modelCO2.ModelCO2_bis.html">ModelCO2_bis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../lms2.logical.html">Logical (lms2.logical)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.logical.hysteresis.html">hysteresis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.logical.hysteresis.Hysteresis.html">Hysteresis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../lms2.mechanic.html">Mechanic (lms2.mechanic)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.mechanic.gears.html">gears</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../lms2.thermal.html">Thermal (lms2.thermal)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../generated/lms2.thermal.dipoles.html">dipoles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.thermal.dipoles.TCond.html">TCond</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.thermal.dipoles.TCondRes.html">TCondRes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.thermal.dipoles.TConvRes.html">TConvRes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.thermal.dipoles.TDipole.html">TDipole</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.thermal.dipoles.TResNL.html">TResNL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../generated/lms2.thermal.dipoles.TStorage.html">TStorage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../moduleindex.html">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../references.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">lms2</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>pyomo.core.base.PyomoModel</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyomo.core.base.PyomoModel</h1><div class="highlight"><pre>
<span></span><span class="c1">#  ___________________________________________________________________________</span>
<span class="c1">#</span>
<span class="c1">#  Pyomo: Python Optimization Modeling Objects</span>
<span class="c1">#  Copyright 2017 National Technology and Engineering Solutions of Sandia, LLC</span>
<span class="c1">#  Under the terms of Contract DE-NA0003525 with National Technology and</span>
<span class="c1">#  Engineering Solutions of Sandia, LLC, the U.S. Government retains certain</span>
<span class="c1">#  rights in this software.</span>
<span class="c1">#  This software is distributed under the 3-clause BSD License.</span>
<span class="c1">#  ___________________________________________________________________________</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;ConcreteModel&#39;</span><span class="p">,</span> <span class="s1">&#39;AbstractModel&#39;</span><span class="p">,</span> <span class="s1">&#39;global_option&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">weakref</span> <span class="k">import</span> <span class="n">ref</span> <span class="k">as</span> <span class="n">weakref_ref</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>                         <span class="c1">#pragma:nocover</span>
    <span class="kn">from</span> <span class="nn">ordereddict</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pympler</span> <span class="k">import</span> <span class="n">muppy</span>
    <span class="kn">from</span> <span class="nn">pympler</span> <span class="k">import</span> <span class="n">summary</span>
    <span class="n">pympler_available</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>                         <span class="c1">#pragma:nocover</span>
    <span class="n">pympler_available</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>                         <span class="c1">#pragma:nocover</span>
    <span class="n">pympler_available</span> <span class="o">=</span> <span class="kc">False</span>


<span class="kn">from</span> <span class="nn">pyutilib.math</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyutilib.misc</span> <span class="k">import</span> <span class="n">tuplize</span><span class="p">,</span> <span class="n">Container</span><span class="p">,</span> <span class="n">PauseGC</span><span class="p">,</span> <span class="n">Bunch</span>

<span class="kn">import</span> <span class="nn">pyomo.common</span>
<span class="kn">from</span> <span class="nn">pyomo.common.deprecation</span> <span class="k">import</span> <span class="n">deprecation_warning</span>
<span class="kn">from</span> <span class="nn">pyomo.common.plugin</span> <span class="k">import</span> <span class="n">ExtensionPoint</span>
<span class="kn">from</span> <span class="nn">pyomo.common._task</span> <span class="k">import</span> <span class="n">pyomo_api</span>
<span class="kn">from</span> <span class="nn">pyomo.common.deprecation</span> <span class="k">import</span> <span class="n">deprecation_warning</span>

<span class="kn">from</span> <span class="nn">pyomo.core.expr</span> <span class="k">import</span> <span class="n">expr_common</span>
<span class="kn">from</span> <span class="nn">pyomo.core.expr.symbol_map</span> <span class="k">import</span> <span class="n">SymbolMap</span>

<span class="kn">from</span> <span class="nn">pyomo.core.base.var</span> <span class="k">import</span> <span class="n">_VarData</span><span class="p">,</span> <span class="n">Var</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.constraint</span> <span class="k">import</span> <span class="n">Constraint</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.objective</span> <span class="k">import</span> <span class="n">Objective</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.set_types</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.suffix</span> <span class="k">import</span> <span class="n">active_import_suffix_generator</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.indexed_component</span> <span class="k">import</span> <span class="n">IndexedComponent</span>
<span class="kn">from</span> <span class="nn">pyomo.dataportal</span> <span class="k">import</span> <span class="n">DataPortal</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.plugin</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.numvalue</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.block</span> <span class="k">import</span> <span class="n">SimpleBlock</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.sets</span> <span class="k">import</span> <span class="n">Set</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.component</span> <span class="k">import</span> <span class="n">Component</span><span class="p">,</span> <span class="n">ComponentUID</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.plugin</span> <span class="k">import</span> <span class="n">ModelComponentFactory</span><span class="p">,</span> <span class="n">TransformationFactory</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.label</span> <span class="k">import</span> <span class="n">CNameLabeler</span><span class="p">,</span> <span class="n">CuidLabeler</span>

<span class="kn">import</span> <span class="nn">pyomo.opt</span>
<span class="kn">from</span> <span class="nn">pyomo.opt.results</span> <span class="k">import</span> <span class="n">SolverResults</span><span class="p">,</span> <span class="n">Solution</span><span class="p">,</span> <span class="n">SolutionStatus</span><span class="p">,</span> <span class="n">UndefinedData</span>

<span class="kn">from</span> <span class="nn">six</span> <span class="k">import</span> <span class="n">itervalues</span><span class="p">,</span> <span class="n">iteritems</span><span class="p">,</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">string_types</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="n">xrange</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">unicode</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">basestring</span> <span class="o">=</span> <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pyomo.core&#39;</span><span class="p">)</span>
<span class="n">id_func</span> <span class="o">=</span> <span class="nb">id</span>


<span class="k">def</span> <span class="nf">global_option</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Declare the default value for a global Pyomo configuration option.</span>

<span class="sd">    Example use:</span>

<span class="sd">    @global_option(&#39;config.foo.bar&#39;, 1)</span>
<span class="sd">    def functor():</span>
<span class="sd">        ...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PyomoConfig</span><span class="o">.</span><span class="n">_option</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">wrapper_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper_function</span>


<span class="k">class</span> <span class="nc">PyomoConfig</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a pyomo-specific configuration object, which is a subclass of Container.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_option</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">Container</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;PyomoConfig&#39;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Create the nested options specified by the the PyomoConfig._option</span>
        <span class="c1"># dictionary, which has been populated with the global_option decorator.</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">PyomoConfig</span><span class="o">.</span><span class="n">_option</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">Container</span><span class="p">()</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
            <span class="n">d</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">PyomoConfig</span><span class="o">.</span><span class="n">_option</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">ModelSolution</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="s1">&#39;gap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1">#</span>
        <span class="c1"># entry[name]: id -&gt; (object weakref, entry)</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="s1">&#39;constraint&#39;</span><span class="p">,</span> <span class="s1">&#39;problem&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span> <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; object has no attribute &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                                      <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_metadata&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_metadata&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;_metadata&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">,</span>
            <span class="s1">&#39;_entry&#39;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;_entry&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Note: We must convert all weakrefs to hard refs and</span>
            <span class="c1"># not indirect references like ComponentUIDs because</span>
            <span class="c1"># when it comes time to unpickle, we cannot count on the</span>
            <span class="c1"># model instance to have already been reconstructed --</span>
            <span class="c1"># so things like CUID.find_component will fail (return</span>
            <span class="c1"># None).</span>
            <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">itervalues</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">obj</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;Solution component in &#39;</span><span class="si">%s</span><span class="s2">&#39; no longer &quot;</span>
                        <span class="s2">&quot;accessible: </span><span class="si">%s</span><span class="s2">!&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">entry</span> <span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="n">obj</span><span class="p">(),</span> <span class="n">entry</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;_metadata&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;_entry&#39;</span><span class="p">]):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">tmp</span><span class="p">[</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">weakref_ref</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">entry</span> <span class="p">)</span>


<span class="k">class</span> <span class="nc">ModelSolutions</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="n">weakref_ref</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clear_symbol_maps</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># _symbol_map: smap_id -&gt; SymbolMap</span>
        <span class="k">if</span> <span class="n">clear_symbol_maps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symbol_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solutions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;_instance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span><span class="p">()</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;solutions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solutions</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;symbol_map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_map</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="c1"># Restore the instance weakref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="n">weakref_ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solutions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">solutions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">add_symbol_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol_map</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol_map</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">symbol_map</span><span class="p">)]</span> <span class="o">=</span> <span class="n">symbol_map</span>

    <span class="k">def</span> <span class="nf">delete_symbol_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smap_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">smap_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_map</span><span class="p">[</span><span class="n">smap_id</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">load_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">results</span><span class="p">,</span>
                  <span class="n">allow_consistent_values_for_fixed_vars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">comparison_tolerance_for_fixed_vars</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span>
                  <span class="n">ignore_invalid_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">delete_symbol_map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">default_variable_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">select</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                  <span class="n">ignore_fixed_vars</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load solver results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># If there is a warning, then print a warning message.</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">pyomo</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">SolverStatus</span><span class="o">.</span><span class="n">warning</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;Loading a SolverResults object with a &#39;</span>
                <span class="s1">&#39;warning status into model=</span><span class="si">%s</span><span class="s1">;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;    message from solver=</span><span class="si">%s</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">Message</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="c1"># If the solver status not one of either OK or Warning, then generate an error.</span>
        <span class="c1">#</span>
        <span class="k">elif</span> <span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="n">pyomo</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">SolverStatus</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">pyomo</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">SolverStatus</span><span class="o">.</span><span class="n">aborted</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Loading a SolverResults object with &quot;</span>
                    <span class="s2">&quot;an &#39;aborted&#39; status, but containing a solution&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot load a SolverResults object &quot;</span>
                                 <span class="s2">&quot;with bad status: </span><span class="si">%s</span><span class="s2">&quot;</span>
                                 <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># Clear the solutions, but not the symbol map</span>
            <span class="c1">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">clear_symbol_maps</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Load all solutions</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">smap</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_smap&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">smap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">smap_id</span> <span class="o">=</span> <span class="n">id_func</span><span class="p">(</span><span class="n">smap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_symbol_map</span><span class="p">(</span><span class="n">smap</span><span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">_smap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">smap_id</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_smap_id&#39;</span><span class="p">)</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_solution</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span>
                              <span class="n">smap_id</span><span class="p">,</span>
                              <span class="n">delete_symbol_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                              <span class="n">ignore_invalid_labels</span><span class="o">=</span><span class="n">ignore_invalid_labels</span><span class="p">,</span>
                              <span class="n">default_variable_value</span><span class="o">=</span><span class="n">default_variable_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_solution</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                  <span class="n">smap_id</span><span class="p">,</span>
                                  <span class="n">delete_symbol_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                                  <span class="n">ignore_invalid_labels</span><span class="o">=</span><span class="n">ignore_invalid_labels</span><span class="p">,</span>
                                  <span class="n">default_variable_value</span><span class="o">=</span><span class="n">default_variable_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">delete_symbol_map</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_symbol_map</span><span class="p">(</span><span class="n">smap_id</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Load the first solution into the model</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">select</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">select</span><span class="p">,</span>
                <span class="n">allow_consistent_values_for_fixed_vars</span><span class="o">=</span><span class="n">allow_consistent_values_for_fixed_vars</span><span class="p">,</span>
                <span class="n">comparison_tolerance_for_fixed_vars</span><span class="o">=</span><span class="n">comparison_tolerance_for_fixed_vars</span><span class="p">,</span>
                <span class="n">ignore_invalid_labels</span><span class="o">=</span><span class="n">ignore_invalid_labels</span><span class="p">,</span>
                <span class="n">ignore_fixed_vars</span><span class="o">=</span><span class="n">ignore_fixed_vars</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">store_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">cuid</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a Solution() object that is populated with the values in the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span><span class="p">()</span>
        <span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">results</span><span class="o">.</span><span class="n">_smap_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">soln_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">solutions</span><span class="p">:</span>
            <span class="n">soln</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">()</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">_cuid</span> <span class="o">=</span> <span class="n">cuid</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">soln_</span><span class="o">.</span><span class="n">_metadata</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">soln</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cuid</span><span class="p">:</span>
                <span class="n">labeler</span> <span class="o">=</span> <span class="n">CuidLabeler</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labeler</span> <span class="o">=</span> <span class="n">CNameLabeler</span><span class="p">()</span>
            <span class="n">sm</span> <span class="o">=</span> <span class="n">SymbolMap</span><span class="p">()</span>

            <span class="n">entry</span> <span class="o">=</span> <span class="n">soln_</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Objective</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">vals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="n">soln</span><span class="o">.</span><span class="n">objective</span><span class="p">[</span> <span class="n">sm</span><span class="o">.</span><span class="n">getSymbol</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">labeler</span><span class="p">)</span> <span class="p">]</span> <span class="o">=</span> <span class="n">vals</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">soln_</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Var</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">stale</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">vals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="n">soln</span><span class="o">.</span><span class="n">variable</span><span class="p">[</span> <span class="n">sm</span><span class="o">.</span><span class="n">getSymbol</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">labeler</span><span class="p">)</span> <span class="p">]</span> <span class="o">=</span> <span class="n">vals</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">soln_</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="s1">&#39;constraint&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">vals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">soln</span><span class="o">.</span><span class="n">constraint</span><span class="p">[</span> <span class="n">sm</span><span class="o">.</span><span class="n">getSymbol</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">labeler</span><span class="p">)</span> <span class="p">]</span> <span class="o">=</span> <span class="n">vals</span>
            <span class="n">results</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span> <span class="n">soln</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">solution</span><span class="p">,</span>
                     <span class="n">smap_id</span><span class="p">,</span>
                     <span class="n">delete_symbol_map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">ignore_invalid_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">ignore_missing_symbols</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">default_variable_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span><span class="p">()</span>

        <span class="n">soln</span> <span class="o">=</span> <span class="n">ModelSolution</span><span class="p">()</span>
        <span class="n">soln</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">status</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">message</span><span class="p">)</span> <span class="ow">is</span> <span class="n">UndefinedData</span><span class="p">:</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">message</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">gap</span><span class="p">)</span> <span class="ow">is</span> <span class="n">UndefinedData</span><span class="p">:</span>
            <span class="n">soln</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="s1">&#39;gap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">gap</span>

        <span class="k">if</span> <span class="n">smap_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># Cache symbol names, which might be re-used in subsequent</span>
            <span class="c1"># calls to add_solution()</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">solution</span><span class="o">.</span><span class="n">_cuid</span><span class="p">:</span>
                <span class="c1">#</span>
                <span class="c1"># Loading a solution with CUID keys</span>
                <span class="c1">#</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Var</span><span class="p">):</span>
                        <span class="n">cache</span><span class="p">[</span><span class="n">ComponentUID</span><span class="p">(</span><span class="n">obj</span><span class="p">)]</span> <span class="o">=</span> <span class="n">obj</span>
                    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Objective</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                        <span class="n">cache</span><span class="p">[</span><span class="n">ComponentUID</span><span class="p">(</span><span class="n">obj</span><span class="p">)]</span> <span class="o">=</span> <span class="n">obj</span>
                    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                        <span class="n">cache</span><span class="p">[</span><span class="n">ComponentUID</span><span class="p">(</span><span class="n">obj</span><span class="p">)]</span> <span class="o">=</span> <span class="n">obj</span>

                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;problem&#39;</span><span class="p">,</span> <span class="s1">&#39;objective&#39;</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="s1">&#39;constraint&#39;</span><span class="p">]:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">cuid</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">name</span><span class="p">)):</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cuid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">ignore_invalid_labels</span><span class="p">:</span>
                                <span class="k">continue</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;CUID </span><span class="si">%s</span><span class="s2"> is missing from model </span><span class="si">%s</span><span class="s2">&quot;</span>
                                               <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cuid</span><span class="p">),</span> <span class="n">instance</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                        <span class="n">tmp</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">weakref_ref</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#</span>
                <span class="c1"># Loading a solution with string keys</span>
                <span class="c1">#</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Var</span><span class="p">):</span>
                        <span class="n">cache</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
                    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Objective</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                        <span class="n">cache</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
                    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                        <span class="n">cache</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>

                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;problem&#39;</span><span class="p">,</span> <span class="s1">&#39;objective&#39;</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="s1">&#39;constraint&#39;</span><span class="p">]:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">symb</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">name</span><span class="p">)):</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">ignore_invalid_labels</span><span class="p">:</span>
                                <span class="k">continue</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Symbol </span><span class="si">%s</span><span class="s2"> is missing from model </span><span class="si">%s</span><span class="s2">&quot;</span>
                                               <span class="o">%</span> <span class="p">(</span><span class="n">symb</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                        <span class="n">tmp</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">weakref_ref</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># Map solution</span>
            <span class="c1">#</span>
            <span class="n">smap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_map</span><span class="p">[</span><span class="n">smap_id</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;problem&#39;</span><span class="p">,</span> <span class="s1">&#39;objective&#39;</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="s1">&#39;constraint&#39;</span><span class="p">]:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">symb</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">name</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">smap</span><span class="o">.</span><span class="n">bySymbol</span><span class="p">:</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="n">smap</span><span class="o">.</span><span class="n">bySymbol</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">smap</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="n">smap</span><span class="o">.</span><span class="n">aliases</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">ignore_missing_symbols</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>                                   <span class="c1">#pragma:nocover</span>
                        <span class="c1">#</span>
                        <span class="c1"># This should never happen ...</span>
                        <span class="c1">#</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                            <span class="s2">&quot;ERROR: Symbol </span><span class="si">%s</span><span class="s2"> is missing from &quot;</span>
                            <span class="s2">&quot;model </span><span class="si">%s</span><span class="s2"> when loading with a symbol map!&quot;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">symb</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

                    <span class="n">tmp</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">())]</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="c1"># Wrap up</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">delete_symbol_map</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_symbol_map</span><span class="p">(</span><span class="n">smap_id</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># Collect fixed variables</span>
        <span class="c1">#</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">vdata</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">component_data_objects</span><span class="p">(</span><span class="n">Var</span><span class="p">):</span>
            <span class="n">id_</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">vdata</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vdata</span><span class="o">.</span><span class="n">fixed</span><span class="p">:</span>
                <span class="n">tmp</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">weakref_ref</span><span class="p">(</span><span class="n">vdata</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span><span class="n">value</span><span class="p">(</span><span class="n">vdata</span><span class="p">)})</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">default_variable_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> \
                 <span class="p">(</span><span class="n">smap_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> \
                 <span class="p">(</span><span class="n">id_</span> <span class="ow">in</span> <span class="n">smap</span><span class="o">.</span><span class="n">byObject</span><span class="p">)</span> <span class="ow">and</span> \
                 <span class="p">(</span><span class="n">id_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">):</span>
                <span class="n">tmp</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">weakref_ref</span><span class="p">(</span><span class="n">vdata</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span><span class="n">default_variable_value</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">solutions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">soln</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solutions</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
               <span class="n">allow_consistent_values_for_fixed_vars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">comparison_tolerance_for_fixed_vars</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span>
               <span class="n">ignore_invalid_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">ignore_fixed_vars</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select a solution from the model&#39;s solutions.</span>

<span class="sd">        allow_consistent_values_for_fixed_vars: a flag that</span>
<span class="sd">        indicates whether a solution can specify consistent</span>
<span class="sd">        values for variables in the model that are fixed.</span>

<span class="sd">        ignore_invalid_labels: a flag that indicates whether</span>
<span class="sd">        labels in the solution that don&#39;t appear in the model</span>
<span class="sd">        yield an error. This allows for loading a results object</span>
<span class="sd">        generated from one model into another related, but not</span>
<span class="sd">        identical, model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># Set the &quot;stale&quot; flag of each variable in the model prior to loading the</span>
        <span class="c1"># solution, so you known which variables have &quot;real&quot; values and which ones don&#39;t.</span>
        <span class="c1">#</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">_flag_vars_as_stale</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">soln</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solutions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

        <span class="c1">#</span>
        <span class="c1"># Generate the list of active import suffixes on this top level model</span>
        <span class="c1">#</span>
        <span class="n">valid_import_suffixes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">active_import_suffix_generator</span><span class="p">(</span><span class="n">instance</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="c1"># To ensure that import suffix data gets properly overwritten (e.g.,</span>
        <span class="c1"># the case where nonzero dual values exist on the suffix and but only</span>
        <span class="c1"># sparse dual values exist in the results object) we clear all active</span>
        <span class="c1"># import suffixes.</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">itervalues</span><span class="p">(</span><span class="n">valid_import_suffixes</span><span class="p">):</span>
            <span class="n">suffix</span><span class="o">.</span><span class="n">clear_all_values</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># Load problem (model) level suffixes. These would only come from ampl</span>
        <span class="c1"># interfaced solution suffixes at this point in time.</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="p">(</span><span class="n">pobj</span><span class="p">,</span><span class="n">entry</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">soln</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="s1">&#39;problem&#39;</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">_attr_key</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
                <span class="n">attr_key</span> <span class="o">=</span> <span class="n">_attr_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">_attr_key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">attr_key</span> <span class="ow">in</span> <span class="n">valid_import_suffixes</span><span class="p">:</span>
                    <span class="n">valid_import_suffixes</span><span class="p">[</span><span class="n">attr_key</span><span class="p">][</span><span class="n">pobj</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr_value</span>
        <span class="c1">#</span>
        <span class="c1"># Load objective data (suffixes)</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="p">(</span><span class="n">odata</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">soln</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">]):</span>
            <span class="n">odata</span> <span class="o">=</span> <span class="n">odata</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">_attr_key</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
                <span class="n">attr_key</span> <span class="o">=</span> <span class="n">_attr_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">_attr_key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">attr_key</span> <span class="ow">in</span> <span class="n">valid_import_suffixes</span><span class="p">:</span>
                    <span class="n">valid_import_suffixes</span><span class="p">[</span><span class="n">attr_key</span><span class="p">][</span><span class="n">odata</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr_value</span>
        <span class="c1">#</span>
        <span class="c1"># Load variable data (suffixes and values)</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="p">(</span><span class="n">vdata</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">soln</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]):</span>
            <span class="n">vdata</span> <span class="o">=</span> <span class="n">vdata</span><span class="p">()</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">vdata</span><span class="o">.</span><span class="n">fixed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ignore_fixed_vars</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_consistent_values_for_fixed_vars</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Variable &#39;</span><span class="si">%s</span><span class="s2">&#39; in model &#39;</span><span class="si">%s</span><span class="s2">&#39; is currently fixed - new&quot;</span> \
                          <span class="s1">&#39; value is not expected in solution&#39;</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">vdata</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="n">vdata</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">comparison_tolerance_for_fixed_vars</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Variable &#39;</span><span class="si">%s</span><span class="s2">&#39; in model &#39;</span><span class="si">%s</span><span class="s2">&#39; is currently &quot;</span>
                                    <span class="s2">&quot;fixed - a value of &#39;</span><span class="si">%s</span><span class="s2">&#39; in solution is &quot;</span>
                                    <span class="s2">&quot;not within tolerance=</span><span class="si">%s</span><span class="s2"> of the current &quot;</span>
                                    <span class="s2">&quot;value of &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                                    <span class="o">%</span> <span class="p">(</span><span class="n">vdata</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                       <span class="n">instance</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                       <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">),</span>
                                       <span class="nb">str</span><span class="p">(</span><span class="n">comparison_tolerance_for_fixed_vars</span><span class="p">),</span>
                                       <span class="nb">str</span><span class="p">(</span><span class="n">vdata</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>

            <span class="n">vdata</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">vdata</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">for</span> <span class="n">_attr_key</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
                <span class="n">attr_key</span> <span class="o">=</span> <span class="n">_attr_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">_attr_key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">attr_key</span> <span class="o">==</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">attr_key</span> <span class="ow">in</span> <span class="n">valid_import_suffixes</span><span class="p">:</span>
                    <span class="n">valid_import_suffixes</span><span class="p">[</span><span class="n">attr_key</span><span class="p">][</span><span class="n">vdata</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr_value</span>
        <span class="c1">#</span>
        <span class="c1"># Load constraint data (suffixes)</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="p">(</span><span class="n">cdata</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">soln</span><span class="o">.</span><span class="n">_entry</span><span class="p">[</span><span class="s1">&#39;constraint&#39;</span><span class="p">]):</span>
            <span class="n">cdata</span> <span class="o">=</span> <span class="n">cdata</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">_attr_key</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
                <span class="n">attr_key</span> <span class="o">=</span> <span class="n">_attr_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">_attr_key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">attr_key</span> <span class="ow">in</span> <span class="n">valid_import_suffixes</span><span class="p">:</span>
                    <span class="n">valid_import_suffixes</span><span class="p">[</span><span class="n">attr_key</span><span class="p">][</span><span class="n">cdata</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr_value</span>


<span class="nd">@ModelComponentFactory</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;Model objects can be used as a component of other models.&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">SimpleBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An optimization model.  By default, this defers construction of components</span>
<span class="sd">    until data is loaded.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">preprocessor_ep</span> <span class="o">=</span> <span class="n">ExtensionPoint</span><span class="p">(</span><span class="n">IPyomoPresolver</span><span class="p">)</span>

    <span class="n">_Block_reserved_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="o">!=</span> <span class="n">Model</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;DEPRECATION WARNING: Using the &#39;Model&#39; class is deprecated.  Please</span>
<span class="sd">use the AbstractModel or ConcreteModel class instead.&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">AbstractModel</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">AbstractModel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor&quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># NOTE: The &#39;ctype&#39; keyword argument is not defined here.  Thus,</span>
        <span class="c1"># a model is treated as a &#39;Block&#39; class type.  This simplifies</span>
        <span class="c1"># the definition of the block_data_objects() method, since we treat</span>
        <span class="c1"># Model and Block objects as the same.  Similarly, this avoids</span>
        <span class="c1"># the requirement to import PyomoModel.py in the block.py file.</span>
        <span class="c1">#</span>
        <span class="n">SimpleBlock</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span> <span class="o">=</span> <span class="n">Container</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">PyomoConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solutions</span> <span class="o">=</span> <span class="n">ModelSolutions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">preprocessor</span> <span class="o">=</span> <span class="s1">&#39;pyomo.model.simple_preprocessor&#39;</span>

    <span class="k">def</span> <span class="nf">compute_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute model statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">number_of_variables</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">number_of_constraints</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">number_of_objectives</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_data_objects</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="n">active</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_map</span><span class="p">(</span><span class="n">Var</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="n">active</span><span class="p">)</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">number_of_variables</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_map</span><span class="p">(</span><span class="n">Objective</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="n">active</span><span class="p">)</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">number_of_objectives</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_map</span><span class="p">(</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="n">active</span><span class="p">)</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">number_of_constraints</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nvariables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_statistics</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">number_of_variables</span>

    <span class="k">def</span> <span class="nf">nconstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_statistics</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">number_of_constraints</span>

    <span class="k">def</span> <span class="nf">nobjectives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_statistics</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">number_of_objectives</span>

    <span class="k">def</span> <span class="nf">create_instance</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">namespace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">namespaces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">profile_memory</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">report_timing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwds</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a concrete instance of an abstract model, possibly using data</span>
<span class="sd">        read in from a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: `str`, optional           </span>
<span class="sd">            The name of a Pyomo Data File that will be used to load data into </span>
<span class="sd">            the model.</span>
<span class="sd">        data: `dict`, optional</span>
<span class="sd">            A dictionary containing initialization data for the model to be </span>
<span class="sd">            used if there is no filename</span>
<span class="sd">        name: `str`, optional</span>
<span class="sd">            The name given to the model.</span>
<span class="sd">        namespace: `str`, optional          </span>
<span class="sd">            A namespace used to select data.</span>
<span class="sd">        namespaces: `list`, optional   </span>
<span class="sd">            A list of namespaces used to select data.</span>
<span class="sd">        profile_memory: `int`, optional    </span>
<span class="sd">            A number that indicates the profiling level.</span>
<span class="sd">        report_timing: `bool`, optional     </span>
<span class="sd">            Report timing statistics during construction.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># Generate a warning if this is a concrete model but the</span>
        <span class="c1"># filename is specified.  A concrete model is already</span>
        <span class="c1"># constructed, so passing in a data file is a waste of time.</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_constructed</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The filename=</span><span class="si">%s</span><span class="s2"> will not be loaded - supplied as an &quot;</span> \
                  <span class="s2">&quot;argument to the create_instance() method of a &quot;</span>\
                  <span class="s2">&quot;concrete instance with name=</span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;clone&#39;</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;clone&#39;</span><span class="p">)</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="s2">&quot;Model.create_instance() no longer accepts the &#39;clone&#39; &quot;</span>
                <span class="s2">&quot;argument: the base abstract model is always cloned.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;preprocess&#39;</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;preprocess&#39;</span><span class="p">)</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="s2">&quot;Model.create_instance() no longer accepts the preprocess&#39; &quot;</span>
                <span class="s2">&quot;argument: preprocessing is always deferred to when the &quot;</span>
                <span class="s2">&quot;model is sent to the solver&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> \
<span class="sd">&quot;&quot;&quot;Model.create_instance() passed the following unrecognized keyword</span>
<span class="sd">arguments (which have been ignored):&quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_constructed</span><span class="p">():</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="s2">&quot;Cannot call Model.create_instance() on a constructed &quot;</span>
                <span class="s2">&quot;model; returning a clone of the current model instance.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">report_timing</span><span class="p">:</span>
            <span class="n">pyomo</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">timing</span><span class="o">.</span><span class="n">report_timing</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Model.create_instance() passed both &#39;filename&#39; &quot;</span>
                               <span class="s2">&quot;and &#39;data&#39; keyword arguments.  Ignoring the &quot;</span>
                               <span class="s2">&quot;&#39;data&#39; argument&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1">#</span>
        <span class="c1"># Clone the model and load the data</span>
        <span class="c1">#</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># If someone passed a rule for creating the instance, fire the</span>
        <span class="c1"># rule before constructing the components.</span>
        <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">_rule</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_rule</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">namespaces</span><span class="p">:</span>
            <span class="n">_namespaces</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">namespaces</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_namespaces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_namespaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_namespaces</span><span class="p">:</span>
            <span class="n">_namespaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">instance</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span>
                       <span class="n">namespaces</span><span class="o">=</span><span class="n">_namespaces</span><span class="p">,</span>
                       <span class="n">profile_memory</span><span class="o">=</span><span class="n">profile_memory</span> <span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># Preprocess the new model</span>
        <span class="c1">#</span>

        <span class="k">if</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">preprocess</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">report_timing</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="n">instance</span><span class="o">.</span><span class="n">preprocess</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">report_timing</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      </span><span class="si">%6.2f</span><span class="s2"> seconds required for preprocessing&quot;</span> <span class="o">%</span> <span class="n">total_time</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">pympler_available</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">profile_memory</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">mem_used</span> <span class="o">=</span> <span class="n">muppy</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">muppy</span><span class="o">.</span><span class="n">get_objects</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      Total memory = </span><span class="si">%d</span><span class="s2"> bytes following instance preprocessing&quot;</span> <span class="o">%</span> <span class="n">mem_used</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">pympler_available</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">profile_memory</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      Summary of objects following instance preprocessing&quot;</span><span class="p">)</span>
                <span class="n">post_preprocessing_summary</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">muppy</span><span class="o">.</span><span class="n">get_objects</span><span class="p">())</span>
                <span class="n">summary</span><span class="o">.</span><span class="n">print_</span><span class="p">(</span><span class="n">post_preprocessing_summary</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># Indicate that the model is concrete/constructed</span>
        <span class="c1">#</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">_constructed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1">#</span>
        <span class="c1"># Change this class from &quot;Abstract&quot; to &quot;Concrete&quot;.  It is</span>
        <span class="c1"># absolutely crazy that this is allowed in Python, but since the</span>
        <span class="c1"># AbstractModel and ConcreteModel are basically identical, we</span>
        <span class="c1"># can &quot;reassign&quot; the new concrete instance to be an instance of</span>
        <span class="c1"># ConcreteModel</span>
        <span class="c1">#</span>
        <span class="n">instance</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">ConcreteModel</span>
        <span class="k">return</span> <span class="n">instance</span>


    <span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preprocessor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply the preprocess plugins defined by the user&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">PauseGC</span><span class="p">()</span> <span class="k">as</span> <span class="n">pgc</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">preprocessor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">preprocessor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">preprocessor</span>
            <span class="n">pyomo</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">PyomoAPIFactory</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">namespaces</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">profile_memory</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">report_timing</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the model with data from a file, dictionary or DataPortal object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">report_timing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">deprecation_warning</span><span class="p">(</span>
                <span class="s2">&quot;The report_timing argument to Model.load() is deprecated.  &quot;</span>
                <span class="s2">&quot;Use pyomo.common.timing.report_timing() to enable reporting &quot;</span>
                <span class="s2">&quot;construction timing&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">dp</span> <span class="o">=</span> <span class="n">DataPortal</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">arg</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="ow">is</span> <span class="n">DataPortal</span><span class="p">:</span>
            <span class="n">dp</span> <span class="o">=</span> <span class="n">arg</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">dp</span> <span class="o">=</span> <span class="n">DataPortal</span><span class="p">(</span><span class="n">data_dict</span><span class="o">=</span><span class="n">arg</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">SolverResults</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">solution</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;DEPRECATION WARNING: the Model.load() method is deprecated for</span>
<span class="sd">loading solutions stored in SolverResults objects.  Call</span>
<span class="sd">Model.solutions.load_from().&quot;&quot;&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solutions</span><span class="o">.</span><span class="n">load_from</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;DEPRECATION WARNING: the Model.load() method is deprecated for</span>
<span class="sd">loading solutions stored in SolverResults objects.  By default, results</span>
<span class="sd">from solvers are immediately loaded into the original model instance.&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Cannot load model model data from with object of type &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span> <span class="nb">type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_model_data</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span>
                              <span class="n">namespaces</span><span class="p">,</span>
                              <span class="n">profile_memory</span><span class="o">=</span><span class="n">profile_memory</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_tuplize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">setobj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>            <span class="c1">#pragma:nocover</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">setobj</span><span class="o">.</span><span class="n">dimen</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># dlw december 2017</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">data</span>
            <span class="n">ans</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tuplize</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">setobj</span><span class="o">.</span><span class="n">dimen</span><span class="p">,</span> <span class="n">setobj</span><span class="o">.</span><span class="n">local_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">_load_model_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modeldata</span><span class="p">,</span> <span class="n">namespaces</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load declarations from a DataPortal object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># As we are primarily generating objects here (and acyclic ones</span>
        <span class="c1"># at that), there is no need to run the GC until the entire</span>
        <span class="c1"># model is created.  Simple reference-counting should be</span>
        <span class="c1"># sufficient to keep memory use under control.</span>
        <span class="c1">#</span>
        <span class="k">with</span> <span class="n">PauseGC</span><span class="p">()</span> <span class="k">as</span> <span class="n">pgc</span><span class="p">:</span>

            <span class="c1">#</span>
            <span class="c1"># Unlike the standard method in the pympler summary</span>
            <span class="c1"># module, the tracker doesn&#39;t print 0-byte entries to pad</span>
            <span class="c1"># out the limit.</span>
            <span class="c1">#</span>
            <span class="n">profile_memory</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;profile_memory&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">pympler_available</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">profile_memory</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">mem_used</span> <span class="o">=</span> <span class="n">muppy</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">muppy</span><span class="o">.</span><span class="n">get_objects</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      Total memory = </span><span class="si">%d</span><span class="s2"> bytes prior to model &quot;</span>
                      <span class="s2">&quot;construction&quot;</span> <span class="o">%</span> <span class="n">mem_used</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">pympler_available</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">profile_memory</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
                <span class="n">mem_used</span> <span class="o">=</span> <span class="n">muppy</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">muppy</span><span class="o">.</span><span class="n">get_objects</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      Total memory = </span><span class="si">%d</span><span class="s2"> bytes prior to model &quot;</span>
                      <span class="s2">&quot;construction (after garbage collection)&quot;</span> <span class="o">%</span> <span class="n">mem_used</span><span class="p">)</span>

            <span class="c1">#</span>
            <span class="c1"># Do some error checking</span>
            <span class="c1">#</span>
            <span class="k">for</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">namespaces</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">modeldata</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Cannot access undefined namespace: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">namespace</span><span class="p">)</span>

            <span class="c1">#</span>
            <span class="c1"># Initialize each component in order.</span>
            <span class="c1">#</span>

            <span class="k">for</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">component_map</span><span class="p">()):</span>

                <span class="k">if</span> <span class="n">component</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="ow">is</span> <span class="n">Model</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_component</span><span class="p">(</span><span class="n">modeldata</span><span class="p">,</span> <span class="n">namespaces</span><span class="p">,</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">profile_memory</span><span class="p">)</span>
                <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">IndexedComponent</span><span class="p">):</span>
                        <span class="n">clen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">Component</span><span class="p">)</span>
                        <span class="n">clen</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">%%</span><span class="s2">6.</span><span class="si">%d</span><span class="s2">f seconds required to construct component=</span><span class="si">%s</span><span class="s2">; </span><span class="si">%d</span><span class="s2"> indicies total&quot;</span> \
                              <span class="o">%</span> <span class="p">(</span><span class="n">total_time</span><span class="o">&gt;=</span><span class="mf">0.005</span> <span class="ow">and</span> <span class="mi">2</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">clen</span><span class="p">)</span> \
                              <span class="o">%</span> <span class="n">total_time</span><span class="p">)</span>
                    <span class="n">tmp_clone_counter</span> <span class="o">=</span> <span class="n">expr_common</span><span class="o">.</span><span class="n">clone_counter</span>
                    <span class="k">if</span> <span class="n">clone_counter</span> <span class="o">!=</span> <span class="n">tmp_clone_counter</span><span class="p">:</span>
                        <span class="n">clone_counter</span> <span class="o">=</span> <span class="n">tmp_clone_counter</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;             Cloning detected! (clone count: </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">clone_counters</span><span class="p">)</span>

            <span class="c1"># Note: As is, connectors are expanded when using command-line pyomo but not calling model.create(...) in a Python script.</span>
            <span class="c1"># John says this has to do with extension points which are called from commandline but not when writing scripts.</span>
            <span class="c1"># Uncommenting the next two lines switches this (command-line fails because it tries to expand connectors twice)</span>
            <span class="c1">#connector_expander = ConnectorExpander()</span>
            <span class="c1">#connector_expander.apply(instance=self)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">pympler_available</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">profile_memory</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      Summary of objects following instance construction&quot;</span><span class="p">)</span>
                <span class="n">post_construction_summary</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">muppy</span><span class="o">.</span><span class="n">get_objects</span><span class="p">())</span>
                <span class="n">summary</span><span class="o">.</span><span class="n">print_</span><span class="p">(</span><span class="n">post_construction_summary</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initialize_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modeldata</span><span class="p">,</span> <span class="n">namespaces</span><span class="p">,</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">profile_memory</span><span class="p">):</span>
        <span class="n">declaration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="n">component_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">component_name</span> <span class="ow">in</span> <span class="n">modeldata</span><span class="o">.</span><span class="n">_default</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">declaration</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Set</span><span class="p">:</span>
                <span class="n">declaration</span><span class="o">.</span><span class="n">set_default</span><span class="p">(</span><span class="n">modeldata</span><span class="o">.</span><span class="n">_default</span><span class="p">[</span><span class="n">component_name</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">namespaces</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">component_name</span> <span class="ow">in</span> <span class="n">modeldata</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,{}):</span>
                <span class="k">if</span> <span class="n">declaration</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="ow">is</span> <span class="n">Set</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tuplize</span><span class="p">(</span><span class="n">modeldata</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">component_name</span><span class="p">],</span>
                                         <span class="n">declaration</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">modeldata</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">component_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">__debug__</span> <span class="ow">and</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
            <span class="n">_blockName</span> <span class="o">=</span> <span class="s2">&quot;Model&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_block</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span> \
                <span class="k">else</span> <span class="s2">&quot;Block &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span> <span class="s2">&quot;Constructing </span><span class="si">%s</span><span class="s2"> &#39;</span><span class="si">%s</span><span class="s2">&#39; on </span><span class="si">%s</span><span class="s2"> from data=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                          <span class="n">declaration</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                          <span class="n">declaration</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">_blockName</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">declaration</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Constructing component &#39;</span><span class="si">%s</span><span class="s2">&#39; from data=</span><span class="si">%s</span><span class="s2"> failed:</span><span class="se">\n</span><span class="s2">    </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">declaration</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">err</span> <span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">if</span> <span class="n">__debug__</span> <span class="ow">and</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
                <span class="n">_out</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
                <span class="n">declaration</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">ostream</span><span class="o">=</span><span class="n">_out</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Constructed component &#39;</span><span class="si">%s</span><span class="s2">&#39;:</span><span class="se">\n</span><span class="s2">    </span><span class="si">%s</span><span class="s2">&quot;</span>
                             <span class="o">%</span> <span class="p">(</span> <span class="n">declaration</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">_out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">pympler_available</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">profile_memory</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">mem_used</span> <span class="o">=</span> <span class="n">muppy</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">muppy</span><span class="o">.</span><span class="n">get_objects</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      Total memory = </span><span class="si">%d</span><span class="s2"> bytes following construction of component=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mem_used</span><span class="p">,</span> <span class="n">component_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">pympler_available</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">profile_memory</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
            <span class="n">mem_used</span> <span class="o">=</span> <span class="n">muppy</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">muppy</span><span class="o">.</span><span class="n">get_objects</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      Total memory = </span><span class="si">%d</span><span class="s2"> bytes following construction of component=</span><span class="si">%s</span><span class="s2"> (after garbage collection)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mem_used</span><span class="p">,</span> <span class="n">component_name</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a concrete instance of this Model, possibly using data</span>
<span class="sd">        read in from a file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;DEPRECATION WARNING: the Model.create() method is deprecated.  Call</span>
<span class="sd">Model.create_instance() to create a concrete instance from an abstract</span>
<span class="sd">model.  You do not need to call Model.create() for a concrete model.&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_instance</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;DEPRECATION WARNING: Model.transform() is deprecated.  Use</span>
<span class="sd">the TransformationFactory iterator to get the list of known</span>
<span class="sd">transformations.&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">TransformationFactory</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;DEPRECATION WARNING: Model.transform() is deprecated.  Use</span>
<span class="sd">TransformationFactory(&#39;%s&#39;) to construct a transformation object, or</span>
<span class="sd">TransformationFactory(&#39;%s&#39;).apply_to(model) to directly apply the</span>
<span class="sd">transformation to the model instance.&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">name</span><span class="p">,)</span> <span class="p">)</span>

        <span class="n">xfrm</span> <span class="o">=</span> <span class="n">TransformationFactory</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xfrm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown model transformation &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xfrm</span><span class="o">.</span><span class="n">apply_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>


<span class="nd">@ModelComponentFactory</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;A concrete optimization model that does not defer construction of components.&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ConcreteModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A concrete optimization model that does not defer construction of</span>
<span class="sd">    components.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;concrete&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>


<span class="nd">@ModelComponentFactory</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;An abstract optimization model that defers construction of components.&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AbstractModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An abstract optimization model that defers construction of</span>
<span class="sd">    components.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>


<span class="c1">#</span>
<span class="c1"># Create a Model and record all the default attributes, methods, etc.</span>
<span class="c1"># These will be assumes to be the set of illegal component names.</span>
<span class="c1">#</span>
<span class="c1"># Note that creating a Model will result in a warning, so we will</span>
<span class="c1"># (arbitrarily) choose a ConcreteModel as the definitive list of</span>
<span class="c1"># reserved names.</span>
<span class="c1">#</span>
<span class="n">Model</span><span class="o">.</span><span class="n">_Block_reserved_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">ConcreteModel</span><span class="p">()))</span>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2019, lms2 Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>